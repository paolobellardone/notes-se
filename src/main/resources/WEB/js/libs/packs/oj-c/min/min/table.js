define("oj-c/hooks/UNSAFE_useListData/useListData",["require","exports","ojs/ojdatacollection-common","ojs/ojdataproviderfactory","preact/hooks"],(function(require,e,t,r,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getEmptyState=e.useListData=void 0;const n=Object.freeze({status:"loading",data:null}),o={isInitialFetchDeferred:!1};e.useListData=(r,c=o)=>{const d=(0,a.useRef)(null),u=(0,a.useRef)(0),m=(0,a.useRef)(!1),p=(0,a.useRef)(null),h=(0,a.useRef)(null),g=c.fetchSize&&c.fetchSize>0?c.fetchSize:25,v=(0,a.useMemo)((()=>s(r)),[r]),[w,k]=(0,a.useReducer)(l,0===c.initialRowsFetched?(0,e.getEmptyState)("atLeast"):n),j=(0,a.useCallback)((async(e,t)=>{if(null==v)return;const r={attributes:c.attributes,sortCriteria:c.sortCriteria,filterCriterion:c.filterCriterion,offset:e.offset,size:e.count},a=!0===m.current?"exact":"atLeast";if(0!==e.count)try{const n=(await v.fetchByOffset(r)).results;t&&t(n),k({status:"success",data:{offset:e.offset,data:n,totalSize:u.current,sizePrecision:a}})}catch(e){k({status:"error",error:e})}else k({status:"success",data:{offset:e.offset,data:[],totalSize:u.current,sizePrecision:a}})}),[v,c.attributes,c.filterCriterion,c.sortCriteria]),C=(0,a.useCallback)((async()=>{if(null==v)return;"loading"===w.status&&h.current?.abort((0,t.getAbortReason)()),k({status:"loading",data:null});const e=new AbortController;h.current=e;const r=v.fetchFirst({attributes:c.attributes,sortCriteria:c.sortCriteria,filterCriterion:c.filterCriterion,size:g,signal:e.signal})[Symbol.asyncIterator]();p.current=r;try{const e=await r.next();if(r!==p.current)return;const t=e.value.fetchParameters;if(t.signal&&t.signal.aborted)return;u.current=e.value.data.length,void 0!==e.done&&(m.current=e.done);const a=c.initialRowsFetched&&c.initialRowsFetched>0?c.initialRowsFetched:g;j({offset:0,count:Math.min(u.current,a)})}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return;k({status:"error",error:e}),p.current=null}}),[v,j,g,c.attributes,c.filterCriterion,c.initialRowsFetched,c.sortCriteria,c.fetchSize]),S=(0,a.useCallback)((async e=>{if(null===p.current)C();else{const t=e.offset+e.count;if(t>u.current){if(null==d.current){const r=i(p,u.current,t);d.current=r;try{const t=await r;void 0!==t.done&&(m.current=t.done);const a=t.total;(a>0||0===a&&m.current)&&(u.current=a,j({offset:e.offset,count:Math.min(u.current-e.offset,e.count)})),d.current=null}catch(e){k({status:"error",error:e}),d.current=null}}}else j(e)}}),[C,j]),T=(0,a.useCallback)((()=>{p.current=null,d.current=null,u.current=0,m.current=!1,0===c.initialRowsFetched?k((0,e.getEmptyState)("atLeast")):c.isInitialFetchDeferred?k({status:"loading",data:null}):C()}),[C,c.isInitialFetchDeferred,c.initialRowsFetched]);(0,a.useEffect)((()=>{v&&T()}),[v,T]);const x=(0,a.useCallback)((e=>{if("success"===w.status&&w.data){const t=w.data;let r,a=t.data.length,n=!1;if(e.detail.add){const r=f(e.detail.add,t,c,!0);u.current=u.current+r,a+=r,n=r>0||"exact"===t.sizePrecision,r<e.detail.add.data.length&&(m.current=!1)}if(e.detail.remove){const r=f(e.detail.remove,t,c,!1);u.current=Math.max(0,u.current-r),a=Math.max(0,a-r),n=n||r>0}const o=e.detail.update;o&&(n=n||y(o,t,c),r=e=>{b(o,t,e)}),n&&j({offset:t.offset,count:a},r)}}),[w,c,j]),R=(0,a.useCallback)((e=>{let t=-1;const r=e.detail?.disregardAfterKey;if(r&&"success"===w.status){const e=w.data.data.findIndex((e=>e.metadata.key===r));if(e>-1&&(t=w.data.data.length-e-1),0===t&&w.data.data.length>=g)return}t>-1&&"success"===w.status?(u.current=u.current-t,S({offset:w.data.offset,count:Math.max(w.data.data.length,g)})):("loading"===w.status&&h.current?.abort(),T())}),[w,g,S,T]);if((0,a.useEffect)((()=>(v&&(v.addEventListener("refresh",R),v.addEventListener("mutate",x)),()=>{v&&(v.removeEventListener("refresh",R),v.removeEventListener("mutate",x))})),[v,T,x,R]),!r){return[(0,e.getEmptyState)("exact"),e=>Promise.resolve()]}return[w,S]};const s=e=>{if(null==e)return null;return(0,r.getEnhancedDataProvider)(e,{fetchFirst:{caching:"visitedByCurrentIterator"}})},l=(e,t)=>e.status===t.status&&"loading"===t.status?e:t,i=async(e,t,r)=>await c(e,t,r),c=async(e,t,r)=>{const a=e.current;if(null===a)return{total:-1,done:void 0};const n=await a.next();return a===e.current?(t+=n.value.data.length)>=r||n.done?{total:t,done:n.done}:c(e,t,r):{total:-1,done:void 0}};e.getEmptyState=e=>"atLeast"===e?d:u;const d=Object.freeze({status:"success",data:{offset:0,data:[],totalSize:0,sizePrecision:"atLeast"}}),u=Object.freeze({status:"success",data:{offset:0,data:[],totalSize:0,sizePrecision:"exact"}}),f=(e,t,r,a)=>{let n=0;if(m(e,r)){const r=a?e.indexes?.sort(((e,t)=>e-t)):e.indexes;let o=t.totalSize-1;r?.forEach((e=>{e<=o&&(n=n+=1,a&&(o=o+=1))}))}else if(a);else{const r=t.data.map((e=>e.metadata.key));e.keys.forEach((e=>{r.includes(e)&&(n+=1)}))}return n},y=(e,t,r)=>{if(m(e,r)){const r=e.indexes?e.indexes:[],a=t.offset,n=a+t.data.length;for(let e=0;e<r.length;e++)if(r[e]>=a&&r[e]<n)return!0}else{const r=Array.from(e.keys),a=t.data.map((e=>e.metadata.key));for(let e=0;e<r.length;e++){const t=r[e];if(a.includes(t))return!0}}return!1},b=(e,t,r)=>{e.keys.forEach((e=>{const a=r.find((t=>t.metadata.key==e)),n=t.data.find((t=>t.metadata.key==e));n&&a&&n.data===a.data&&(a.data=new Proxy(a.data,{}))}))},m=(e,t)=>e.indexes&&null==t.sortCriteria&&null==t.filterCriterion})),define("oj-c/utils/PRIVATE_keyUtils/keySetUtils",["require","exports","ojs/ojkeyset"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isEqual=e.getFirstKey=e.isEmpty=e.keysToKeySet=e.keySetToKeys=void 0;e.keySetToKeys=e=>{if(!e)return{all:!1,keys:new Set};let t={};if(e.isAddAll()){t={all:!0,deletedKeys:new Set(e.deletedValues())}}else if(!e.isAddAll()){t={all:!1,keys:new Set(e.values())}}return t};e.keysToKeySet=e=>{let r;return e.all?(r=new t.AllKeySetImpl,r=r.delete(new Set(e.deletedKeys.values()))):e.all||(r=new t.KeySetImpl(new Set(e.keys.values()))),r};e.isEmpty=e=>!e.all&&0===e.keys.size;e.getFirstKey=(e,t)=>{if(!1===e.all&&e.keys.size>0){const[t]=e.keys;return t}return t.length>0?t[0]:null};e.isEqual=(e,t)=>{if(e===t)return!0;if(e.keys.all!==t.keys.all)return!1;const r=!0===e.keys.all?Array.from(e.keys.deletedKeys.values()):Array.from(e.keys.keys.values()),a=!0===t.keys.all?Array.from(t.keys.deletedKeys.values()):Array.from(t.keys.keys.values());if(r.length!==a.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!==a[e])return!1;return!0}})),define("oj-c/table/table",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/translationBundle","ojs/ojcustomelement-registry","ojs/ojcontext","ojs/ojvcomponent","preact/hooks","../hooks/UNSAFE_useListData/useListData","@oracle/oraclejet-preact/UNSAFE_TableView","ojs/ojkeyset","../utils/PRIVATE_keyUtils/keySetUtils","@oracle/oraclejet-preact/hooks/UNSAFE_useCollectionInteractionContext","@oracle/oraclejet-preact/hooks/UNSAFE_useFormVariantContext","css!oj-c/table/table-styles.css"],(function(require,e,t,r,a,n,o,s,l,i,c,d,u,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Table=void 0;const y="oj-c-table_selection",b={},m={row:"none",column:"none"},p={fetchSize:25};e.Table=(0,o.registerCustomElement)("oj-c-table",(function({"aria-label":e,"aria-labelledby":r,id:a,data:u,columns:h,row:g,horizontalGridVisible:v="enabled",verticalGridVisible:w="disabled",layout:k="contents",currentCellOverride:j,onCurrentCellChanged:C,selected:S=b,selectionMode:T=m,onSelectedChanged:x,selectAllControl:R="visible",columnOrder:A,cellTemplate:E,headerTemplate:z,footerTemplate:P,templates:_,onOjRowAction:O,noData:K,columnWidths:D,scrollPolicyOptions:M=p}){const L=(0,s.useRef)(null),F=(0,s.useRef)(null),V=(0,s.useCallback)((e=>null!=e&&null!=L.current&&function(e,t){let r=e.target;for(;null!=r&&r!==t;){if("disabled"===r.dataset.ojClickthrough)return!0;r=r.parentNode}return!1}({target:e},L.current)),[]),[I,B]=(0,l.useListData)(u,{fetchSize:M?.fetchSize}),U=(0,s.useCallback)((()=>{if("success"===I.status&&I.data&&B){const e=M&&null!=M.fetchSize?M.fetchSize:25;B({offset:0,count:I.data.data.length+e})}}),[I,B,M]),H="loading"===I.status||"success"===I.status&&"atLeast"===I.data.sizePrecision,W=(0,s.useMemo)((()=>{const e={...D};return"multiple"===T?.row&&(e[y]=36),e}),[T?.row,D]);function N(e){const{data:t}=e;return{item:t}}const G=e=>null!=e.selector?e.selector():void 0,q=e=>null!=e.selector?(0,t.jsx)("div",{"data-oj-table-selector":"all",children:e.selector()}):void 0;function Y(e){if(e)return t=>{const r={key:t.key,headerText:t.headerText,isTabbable:t.isTabbable};return e(r)}}function $(e){if(e)return t=>{const r={key:t.key,footerText:t.footerText,isTabbable:t.isTabbable};return e(r)}}function J(e,t){return r=>{const a={item:r.rowData,columnKey:r.columnKey,data:null!=t?r.rowData.data[t]:void 0,isTabbable:r.isTabbable};return e?e(a):null!=a.data?String(a.data):void 0}}const Q=(0,s.useCallback)((e=>{if(" "===e.key){const t=e.target;if(t.children.length>0&&"all"===t.children[0].dataset.ojTableSelector&&!e.repeat){let e;e=S.row?.isAddAll()&&0===S.row.keys.deletedKeys?.size?new c.KeySetImpl:new c.AllKeySetImpl,x({row:e,column:new c.KeySetImpl})}}}),[x,S]),X="multiple"===T?.row&&"hidden"!==R?{onKeyDown:Q}:{},Z=(0,s.useMemo)((()=>h?function(e,t,r,a,n){const o={};return"multiple"===T?.row&&(o[y]={sticky:"enabled",selectable:"disabled",renderer:G,headerRenderer:"hidden"!==R?q:void 0,padding:"disabled",headerPadding:"disabled",tooltip:"disabled",headerTooltip:"disabled"}),Object.keys(e).forEach((s=>{const l=s,i=e[l],c=i.template&&n&&n[i.template]?J(n[i.template],i.field):J(t,i.field),d=i.headerTemplate&&n&&n[i.headerTemplate]?Y(n[i.headerTemplate]):Y(r),u=i.footerTemplate&&n&&n[i.footerTemplate]?$(n[i.footerTemplate]):$(a),f=i.headerText??void 0,y=i.footerText??void 0,b=i.maxWidth??void 0,m=i.minWidth??void 0,p=i.weight??void 0;let h;const g=i.padding;h="function"==typeof g?e=>{const t=N(e);return g(t)}:g??"enabled";const v=i.headerPadding??"enabled",w=i.footerPadding??"enabled";let k;const j=i.tooltip;k="function"==typeof j?e=>{const t=N(e);return j(t)}:j??"enabled";const C=i.headerTooltip??"enabled",S=i.footerTooltip??"enabled",T=i.sticky??"disabled",x=i.horizontalAlignment??"start";o[l]={headerText:f,footerText:y,renderer:c,headerRenderer:d,footerRenderer:u,maxWidth:b,minWidth:m,weight:p,padding:h,headerPadding:v,footerPadding:w,tooltip:k,headerTooltip:C,footerTooltip:S,sticky:T,horizontalAlignment:x}})),o}(h,E,z,P,_):{}),[h,E,z,P,_,T?.row]),ee=(0,s.useMemo)((()=>{const e=[];let t=!1;if("multiple"===T?.row&&(e.push(y),t=!0),null!=A)for(const t of A)null==Z[t]||e.includes(t)||e.push(t);else for(const[t]of Object.entries(Z))t!==y&&e.push(t);return 1===e.length&&t?[]:e}),[A,T?.row,Z]),te="success"===I.status&&I?.data?.data||[],re=(0,s.useCallback)((e=>{O&&null!=e&&!V(e.target)&&O({context:N(e.context)})}),[O,V,N]),ae=(0,s.useMemo)((()=>({horizontal:"enabled"===v?"visible":"hidden",vertical:"enabled"===w?"visible":"hidden"})),[v,w]),ne=(0,s.useMemo)((()=>function(e){if(e)return t=>e({isTabbable:t.isTabbable})}(K)),[K]),oe=(0,s.useMemo)((()=>S?{row:S.row?(0,d.keySetToKeys)(S.row):void 0,column:S.column?(0,d.keySetToKeys)(S.column):void 0}:void 0),[S?.row,S?.column]),se=(0,s.useCallback)((e=>{if(!V(e.target)){const t=e.value,r=t.row?(0,d.keysToKeySet)(t.row):void 0,a=t.column?(0,d.keysToKeySet)(t.column):void 0;x({row:r,column:a})}}),[x,V]),le=(0,s.useCallback)((e=>{C&&C(e.value)}),[C]),ie=(0,s.useRef)(),ce=(0,s.useRef)(),de=(0,s.useRef)(),ue=(0,s.useRef)(),[fe,ye]=(0,s.useState)("contents"===k),be=(0,s.useRef)(fe);(0,s.useEffect)((()=>{ie.current=n.getContext(L.current).getBusyContext(),ce.current=n.getContext(F.current).getBusyContext()}),[]);const me=(0,s.useCallback)((e=>ie.current?.addBusyState({description:`oj-c-table: ${e}`})),[]);return(0,s.useEffect)((()=>("loading"===I.status?de.current=me("Table is loading data"):be.current&&(ue.current=me("Table content is initializing"),ce.current.whenReady().then((function(){ue.current&&(ue.current(),ue.current=void 0),ye(!1),be.current=!1}))),()=>{de.current&&(de.current(),de.current=void 0),ue.current&&(ue.current(),ue.current=void 0)})),[I.status,me]),(0,t.jsx)(o.Root,{id:a,ref:L,children:(0,t.jsx)("div",{ref:F,"data-oj-context":!0,...X,...E?{"data-oj-ct":!0}:{},...z?{"data-oj-ht":!0}:{},...P?{"data-oj-ft":!0}:{},...K?{"data-oj-ndt":!0}:{},style:"display: contents;",children:(0,t.jsx)(f.FormVariantContext.Provider,{value:"embedded",children:(0,t.jsx)(o.ReportBusyContext.Provider,{value:F,children:(0,t.jsx)(i.TableView,{"aria-label":e,"aria-labelledby":r,columns:Z,data:te,getRowKey:e=>e.metadata.key,getAccessibleRowHeaders:e=>{const t=N(e),r=new Set;if(null!=g&&null!=g.accessibleRowHeader){if("string"==typeof g.accessibleRowHeader)r.add(g.accessibleRowHeader);else if(Array.isArray(g.accessibleRowHeader))g.accessibleRowHeader.forEach((e=>r.add(e)));else if("function"==typeof g.accessibleRowHeader){const e=g.accessibleRowHeader(t);"string"==typeof e?r.add(e):Array.isArray(e)&&e.forEach((e=>r.add(e)))}}else ee.length>0&&("multiple"===T?.row?r.add(ee[1]):r.add(ee[0]));return r},gridlines:ae,layout:fe?"pending":k,selected:oe,selectionMode:T,onSelectionChange:se,columnOrder:ee,onRowAction:re,noDataRenderer:ne,columnWidths:W,onLoadMore:U,hasMore:H,currentCellOverride:j,onPersistCurrentCell:le,width:"100%"})})})})})}),"Table",{properties:{layout:{type:"string",enumValues:["fixed","contents"]},data:{type:"DataProvider"},columns:{type:"object"},row:{type:"object",properties:{accessibleRowHeader:{type:"string|Array<string>|function"}}},horizontalGridVisible:{type:"string",enumValues:["disabled","enabled"]},verticalGridVisible:{type:"string",enumValues:["disabled","enabled"]},selected:{type:"object",properties:{column:{type:"object"},row:{type:"object"}},writeback:!0},selectionMode:{type:"object",properties:{column:{type:"string",enumValues:["none","multiple","single"]},row:{type:"string",enumValues:["none","multiple","single"]}}},selectAllControl:{type:"string",enumValues:["hidden","visible"]},columnOrder:{type:"Array<string>",writeback:!0},currentCellOverride:{type:"object"},currentCell:{type:"object",readOnly:!0,writeback:!0},columnWidths:{type:"object",writeback:!0},scrollPolicyOptions:{type:"object",properties:{fetchSize:{type:"number"}}}},slots:{cellTemplate:{data:{}},headerTemplate:{data:{}},footerTemplate:{data:{}},noData:{data:{}}},extension:{_DYNAMIC_SLOT:{prop:"templates",isTemplate:1},_WRITEBACK_PROPS:["selected","columnOrder","currentCell","columnWidths"],_READ_ONLY_PROPS:["currentCell"],_OBSERVED_GLOBAL_PROPS:["aria-label","aria-labelledby","id"]},events:{ojRowAction:{bubbles:!0}}},{horizontalGridVisible:"enabled",verticalGridVisible:"disabled",layout:"contents",selected:{},selectionMode:{row:"none",column:"none"},selectAllControl:"visible",scrollPolicyOptions:{fetchSize:25}},{"@oracle/oraclejet-preact":r.default},{consume:[u.CollectionInteractionContext]});(0,a.getMetadata)("oj-c-table").properties.__oj_private_do_not_use_userAssistanceDensity={binding:{provide:[{name:"containerUserAssistanceDensity",default:"compact"},{name:"userAssistanceDensity",default:"compact"}]}}})),define("oj-c/table",["require","exports","oj-c/table/table"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Table=void 0,Object.defineProperty(e,"Table",{enumerable:!0,get:function(){return t.Table}})}));
//# sourceMappingURL=table.js.map