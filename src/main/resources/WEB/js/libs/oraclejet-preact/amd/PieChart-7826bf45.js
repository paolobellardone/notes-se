define(['exports', 'preact/jsx-runtime', './UNSAFE_PieChart/themes/PieChartStyles.css', './TrackResizeContainer-c6b5de04', './pathUtils-ec75f879', './layoutUtils-4304ffe4', './classNames-08d99695', './usePieChartNav-f5403629', './useDatatip-db874c22', './layoutUtils-ba7693df', './mergeProps-bcfa6a92', './VisTabularDatatip-23cf3cfc', './colorUtils-bc5b1d84', './accUtils-93ee6f16', './useUser-abae2493', './useTestId-d0c49456', './useVisTouchResponse-88a7bb09', 'preact/hooks', './stringUtils-0ae982c2', './useContextMenu-599ada89', './Menu-bdd771bf', './MenuItem-dc85fcad', 'preact', './logger-0f873e29', './LayerHost-1b4d03f0', 'preact/compat', 'css!./TooltipContentStyles.styles.css', 'module', './hooks/UNSAFE_useTooltip/themes/redwood/TooltipContentVariants.css', './tooltipUtils-304eef18', 'css!./IconStyle.styles.css', './SelectMenuGroupContext-67f24a8f', './UNSAFE_Separator/themes/SeparatorStyles.css', 'css!./MenuSeparatorStyles.styles.css', 'module', './UNSAFE_Menu/themes/redwood/MenuSeparatorVariants.css', './eventsUtils-edf8f4e5'], (function(e,t,s,n,o,a,i,r,l,c,d,u,h,f,p,x,m,b,M,g,y,I,v,C,T,S,w,R,j,A,P,U,V,L,N,D,E){"use strict";const F=.45,k=.38,O=3,_=1.5,B=90;function q(e){return e*(Math.PI/180)}function H(e,t,s,n){const o=Math.atan2(n,s)-Math.atan2(t,e);return o<0?o+2*Math.PI:o}function z(e,t,s,n,a,i,r,l,c){const d=Math.max(n-e,0),u=Math.max(a-e,0),h=360==r||d<e?0:l+2*e,f=i?i+e:0,p=q(360==r?359.99:r),x=q(c),m=h/2,b=m<d?Math.asin(m/d):0,M=-p/2-x,g=Math.min(5*m,p>0?Math.abs(m/Math.sin(p/2)):0),y=0==d?g:g*u/d,I=t+Math.cos(M)*g,v=s+Math.sin(M)*y,C=t+Math.cos(-b-x)*d,T=s+Math.sin(-b-x)*u,S=t+Math.cos(-x-p+b)*d,w=s+Math.sin(-x-p+b)*u;let R,j=H(S-t,w-s,C-t,T-s);if(j=Math.min(j,p),f>0){const e=m<f?Math.asin(m/f):0,n=t+Math.cos(-e-x)*f,a=s+Math.sin(-e-x)*f,i=t+Math.cos(-x-p+e)*f,l=s+Math.sin(-x-p+e)*f;let c=H(i-t,l-s,n-t,a-s);c=Math.min(c,j,p),360==r?(R=o.moveTo(S,w),R+=o.arcTo(d,u,p,1,C,T),R+=o.lineTo(S,w),R+=o.moveTo(n,a),R+=o.arcTo(f,f,p,0,i,l)):(R=o.moveTo(i,l),R+=o.lineTo(S,w),R+=o.arcTo(d,u,j,1,C,T),R+=o.lineTo(n,a),R+=o.arcTo(f,f,c,0,i,l))}else 360==r?(R=o.moveTo(S,w),R+=o.arcTo(d,u,p,1,C,T)):(R=o.moveTo(I,v),R+=o.lineTo(S,w),R+=o.arcTo(d,u,j,1,C,T));return R+=o.closePath(),R}function G(e,t,s){return{innerBounds:{width:Math.sqrt(2)*s,height:Math.sqrt(2)*s,x:e-s/Math.sqrt(2),y:t-s/Math.sqrt(2)},outerBounds:{width:2*s,height:2*s,x:e-s,y:t-s}}}function J(e,t,s,n,o,a){return a?function(e,t,s,n,o,a){const i=(e+t/2)/180*Math.PI,r=(o+a)/2;return{x:s+r*Math.cos(i),y:n-r*Math.sin(i),width:0,height:0}}(e[a.itemIndex].startAngle,e[a.itemIndex].angleExtent,t,s,n,o):void 0}function K(e,t,s){return s?.color||null!=t?.itemIndex?e[t.itemIndex]:void 0}function Q({cx:e,cy:n,r:o,startAngle:a,angleExtent:r,gap:l,innerRadius:c,color:d,id:u,itemIndex:h,isFocused:f=!1,isHovered:p=!1,...x}){const m=z(0,e,n,o,o,c,r,l,a);let b;return f?(b=z(2,e,n,o,o,c,r,l,a),t.jsxs("g",{id:u,role:x.accessibleLabel?"img":void 0,"data-oj-item-index":h,"data-oj-object":"pieSlice","aria-label":x.accessibleLabel,children:[t.jsx("path",{d:m,fill:d,stroke:d,className:s.styles.innerShapes}),t.jsx("path",{d:b,fill:d,className:i.classNames([s.styles.contrastBorder,s.styles.innerShapes])})]})):t.jsx("path",{role:x.accessibleLabel?"img":void 0,"aria-label":x.accessibleLabel,d:m,"data-oj-object":"pieSlice",fill:d,id:u,"data-oj-item-index":h})}const W=({offset:e,rootRef:t,contextMenuConfig:s,focusedItemInfo:n,items:o,onContextMenuDismissed:a,width:i,isRtl:r})=>{const{contextMenuProps:l,contextMenuContent:c}=g.useContextMenu({onContextMenuHandler:({gesture:s,target:a})=>{if("keyboard"===s){const t=n.itemIndex;return{type:"offset",context:{type:"item",data:o[t]},offsetValue:e,isRtl:r,width:i}}const l=E.getInfo(t,a)?.itemIndex,c=void 0!==l?o[l]:null;let d;return d=c?{type:"item",data:c}:t.current?.children[1].contains(a)?{type:"centerLabel"}:{type:"background"},{type:"pointer",context:d}},contextMenuOptions:{isDisabled:!s},rootRef:t,contextMenuConfig:s,onContextMenuDismissed:a});return{contextMenuContent:c,contextMenuProps:l}},X=100;function Y({width:e,height:n,testId:o,innerRadius:i=0,contextMenuConfig:f,...g}){const y=b.useRef(null),I=h.getColorRamp(),{totalValue:v,isLabelOutside:C}=g.data.reduce((({totalValue:e,isLabelOutside:t},s)=>({totalValue:e+s.value,isLabelOutside:t})),{totalValue:0,isLabelOutside:!1});const T=function(e,t){let s,n=B;const o=[];for(let a=0;a<e.length;a++){const i=e[a],r=i.value;s=r===t?100:0===t?0:Math.min(r/t*100,99.99);const l=3.6*s;let c=n-l;c<0&&(c+=360),o.push({index:a,startAngle:c,angleExtent:l,...i}),n=c}return o}(g.data,v),S=g.data.length>0,w=function(e){return O*e}(.5),R=g.data.length>X,{direction:j}=p.useUser(),A=x.useTestId(o),P=a.getAvailSpace(e,n),{cx:U,cy:V}=function(e){return{cx:e.x+Math.floor(e.width/2),cy:e.y+Math.floor(e.height/2)}}(P),L=function(e,t){const s=t?k:F;return Math.floor(Math.min(e.width,e.height)*s)}(P,C),N=i*L,D=function(e,t,s){if(!t)return e;const n=2*Math.PI*s;let o=0;return e.filter((({startAngle:e,angleExtent:t})=>{const s=(t+e)/360*n;return!(t/360*n<_&&Math.abs(o-s)<_||(o=s,0))}))}(T,R,L),E=function(e,t){return({itemIndex:s},n)=>{let o=s;return o=t&&("ArrowRight"===n||"ArrowUp"===n)||!t&&("ArrowLeft"===n||"ArrowDown"===n)?s-1:s+1,{itemIndex:(o%e.length+e.length)%e.length}}}(D,"rtl"===j),{touchResponse:q,touchResponseStyle:H}=m.useVisTouchResponse({type:"auto",supportsTouchDragGestures:!1,rootRef:y}),{activeId:z,navProps:Y,focusedItemInfo:Z,hoveredItemInfo:$,onContextMenuDismissed:ee}=r.usePieChartNav({touchResponse:q,getNextChartItem:E}),te=Z.isFocusVisible?Z:$,se=te?g.data[D[te.itemIndex].index]:void 0,{content:ne,borderColor:oe}=se&&g.datatip?g.datatip({data:se}):((e,s)=>e?e.accessibleLabel?{content:e.accessibleLabel,borderColor:K(I,s,e)}:{content:t.jsx(u.VisTabularDatatip,{tableData:[{key:"Value",value:e.value}]}),borderColor:K(I,s,e)}:{content:void 0,borderColor:void 0})(se,te),ae=Z.isFocusVisible?"element":"pointer",ie=te?.isFocusVisible?J(D,U,V,N,L,te):void 0,re="rtl"===j,le=c.calculateOffset(re,e,ie),{datatipContent:ce,datatipProps:de}=l.useDatatip({content:ne,offset:le,anchor:ae,placement:"top-start",borderColor:oe,touchResponse:q});de["aria-describedby"]=M.merge([g["aria-describedby"],de["aria-describedby"]]);const{contextMenuContent:ue,contextMenuProps:he}=W({offset:le,rootRef:y,contextMenuConfig:S?f:void 0,onContextMenuDismissed:ee,focusedItemInfo:Z,items:T,width:e,isRtl:re}),fe=d.mergeProps(Y,de,he);return t.jsxs("div",{ref:y,tabIndex:0,"aria-label":g["aria-label"],"aria-labelledby":g["aria-labelledby"],"aria-activedescendant":z,role:"application",...fe,...A,className:s.styles.chart,style:{width:e,height:n,...H},children:[D.length>0&&t.jsx("svg",{className:s.styles.svg,children:D.map(((e,s)=>t.jsx(Q,{cx:U,cy:V,itemIndex:s,id:te?.itemIndex===s?z:void 0,isFocused:Z?.itemIndex===s&&Z?.isFocusVisible,isHovered:$?.itemIndex===s,r:L,startAngle:e.startAngle,gap:w,innerRadius:N,angleExtent:e.angleExtent,color:e.color||I[s%I.length],accessibleLabel:e.accessibleLabel},e.id)))}),g.children?.(G(U,V,N)),ce,ue]})}e.PieChart=function({width:e,height:o,...a}){return t.jsx(n.TrackResizeContainer,{width:e,height:o,class:s.dimensionStyle,children:(e,s)=>t.jsx(Y,{width:e,height:s,...a})})}}));
//# sourceMappingURL=PieChart-7826bf45.js.map
