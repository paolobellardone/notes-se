define(['exports', 'preact/jsx-runtime', 'preact/hooks', './Floating-28ad0903', './tabbableUtils-428c264e', './refUtils-d354a169', './FocusTrap-d351e5c9', './Layer-9fb9ca67', 'preact/compat', './LayerHost-1b4d03f0', './Modal-991f1310', './WindowOverlay-00523782', './usePopupAnimation-7023407f', './useTestId-d0c49456', './useOutsideClick-39a81428', './useComponentTheme-5aa41a8f', './UNSAFE_Popup/themes/PopupContract.css', './stringUtils-0ae982c2', './classNames-08d99695', './UNSAFE_Popup/themes/redwood/PopupTheme', './dimensions-fda85d6b', './mergeInterpolations-9ede4cf7'], (function(e,n,t,s,o,r,a,i,c,u,l,d,p,m,f,b,h,y,A,g,x,E){"use strict";const O=c.forwardRef((({anchorRef:e,launcherRef:c,children:u,isOpen:O=!1,modality:v="modeless",offset:F={mainAxis:0,crossAxis:0},flipOptions:P={mainAxis:!0,crossAxis:!0},shiftOptions:C={mainAxis:!1,crossAxis:!1},onClickOutside:k,onClose:R,initialFocus:T="auto",placement:j=(e?"top":"center"),tail:w="none",onTransitionEnd:I,onFocusSet:L,variant:N="standard",role:S=("modeless"===v?"tooltip":"dialog"),"aria-label":U,"aria-labelledby":D,"aria-describedby":M,testId:V,...W},K)=>{const _=t.useRef(null),[H,q]=t.useState(),z=t.useRef(null),B=t.useRef("unmounted"),G=m.useTestId(V),J=[z];_.current&&_.current!==document.body&&J.push(_),f.useOutsideClick({isDisabled:!(O&&z.current),ref:J,handler:e=>{k?.(e)}});const Q=t.useCallback((e=>{_.current===o.getActiveElement()&&"F6"===e.code&&"modeless"===v&&(e.preventDefault(),e.stopPropagation(),o.focusWithin(z.current),L?.())}),[v]),{setAnimationElementRef:X,status:Y,onPosition:Z}=p.usePopupAnimation({isOpen:O,isAnimatedOnMount:!0,onTransitionEnd:e=>{e?(ne(),I?.(!0)):I?.(!1)},placement:j}),$=t.useMemo((()=>r.mergeRefs(z,K)),[z,K]),ee=t.useCallback((()=>{const n=_.current,t=e?.current;n?o.focusOn(n):t&&t instanceof Element&&o.focusOn(t)}),[_,e]);t.useEffect((()=>(O||"opening"!==Y||"modal"===v?O||"unmounted"!==Y||"modal"!==v||Y!==B.current&&ee():z.current?.contains(o.getActiveElement())&&ee(),()=>{B.current=Y})),[O,Y,ee,v]),t.useEffect((()=>(O&&(c?.current&&c.current instanceof Element?_.current=document.body.contains(c.current)?c.current:o.getActiveElement():_.current=o.getActiveElement(),_.current?.addEventListener("keydown",Q)),()=>{_.current?.removeEventListener("keydown",Q)})),[O,c,Q]);const ne=()=>{let e=T;"auto"===T&&(e="modal"===v?"firstFocusable":"none"),"popup"===e&&(o.focusOn(z.current),L?.(),I?.(!1)),"firstFocusable"===e&&(o.focusWithin(z.current),L?.())},te={mainAxis:(e=>{let n=0;return e&&(n="number"==typeof e?e:e.mainAxis||0,"simple"===w&&(n+=5)),n})(F),crossAxis:(e=>e?"number"==typeof e?0:e.crossAxis||0:0)(F)},se=e=>{const n=o.getActiveElement(),t=z.current,s=_.current;if(t===n||t?.contains(n))switch(e.code){case"Escape":R?.({reason:"escapeKey"});break;case"F6":e.preventDefault(),e.stopPropagation(),s&&"modeless"===v&&o.focusOn(s)}};t.useLayoutEffect((()=>{if("unmounted"===Y||null==z.current||null!=H||"none"===w)return;const e=y.getVarName(h.popupVars.backgroundColor),n=getComputedStyle(z.current);q(n.getPropertyValue(e))}),[Y,z,H,w]);const{baseTheme:oe,classes:re}=b.useComponentTheme(g.PopupRedwoodTheme),ae="unmounted"!==Y,ie=[...Object.values(x.dimensionInterpolations)],ce=E.mergeInterpolations(ie),{...ue}=ce(W),le=()=>n.jsx(a.FocusTrap,{restoreFocusRef:!1,children:n.jsx("div",{ref:$,tabIndex:-1,role:S,className:A.classNames([oe,"unstyled"===N?null:re]),style:ue,onKeyDown:se,"aria-label":U,"aria-labelledby":D,"aria-describedby":M,...G,children:u})}),de=()=>e&&e.current?n.jsx(s.Floating,{ref:X,backgroundColor:H,anchorRef:e,placement:j,offsetValue:te,flipOptions:P,shiftOptions:C,tail:w,onPosition:Z,children:le()}):n.jsx(d.WindowOverlay,{placement:j,offset:te,children:n.jsx("div",{ref:X,children:le()})});return ae?"modal"===v?n.jsx(l.Modal,{isOpen:ae,children:de()}):n.jsx(i.Layer,{children:de()}):null}));e.Popup=O}));
//# sourceMappingURL=Popup-bba2ea15.js.map
