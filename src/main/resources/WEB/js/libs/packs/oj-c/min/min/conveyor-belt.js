define("oj-c/conveyor-belt/conveyorBeltItem",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/UNSAFE_ConveyorBelt"],(function(require,e,t,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConveyorBeltItem=void 0;e.ConveyorBeltItem=({context:e,itemTemplate:r})=>{const o={data:e.data.data,item:e.data};return(0,t.jsx)(a.ConveyorBeltItem,{children:r&&r(o)})}})),define("oj-c/hooks/UNSAFE_useDataProvider/utils",["require","exports"],(function(require,e){"use strict";function t(e,t,a,r){const o=[...r];return e.forEach(((e,r)=>{const n={data:t[r],key:a[r]?.key,metadata:a[r]};e>=0?o.splice(e,0,n):o.push(n)})),o}async function a(e,t){const a=[],r=(await e.fetchByKeys({keys:t})).results;for(const e of t)if(r.has(e)){const t=r.get(e);a.push({...t,key:e})}return a}function r(e,t){return e.has(t)?e.get(t):-1}function o(e,t){const a=[...t];return e.sort(((e,t)=>t-e)),e.forEach((e=>{e<a.length&&a.splice(e,1)})),a}Object.defineProperty(e,"__esModule",{value:!0}),e.getUpdatedItemsFromMutationDetail=void 0,e.getUpdatedItemsFromMutationDetail=async function(e,n,s){const{add:i,remove:c,update:l}=e??{},d=new Map;for(const[e,t]of n.entries())d.set(t.key,e);let u=[...n];return c&&(u=function(e,t,a){const{indexes:n,keys:s}=e;let i=[...t];n?.length?i=o(n,i):s?.size&&(i=function(e,t,a){const n=[];return e.forEach((e=>{const t=r(a,e);-1!==t&&n.push(t)})),o(n,t)}(s,i,a));return i}(c,u,d)),i&&(u=await async function(e,o,n,s){const{addBeforeKeys:i,data:c,indexes:l,keys:d,metadata:u}=e;let h=[...o],f=c||[],y=u||[];if(0===f.length&&d?.size){const e=await a(s,d)??[];f=e.map((e=>e.data)),y=e.map((e=>e.metadata))}0===y.length&&d?.size&&(y=[...d].map((e=>({key:e}))));f.length&&(h=l?.length?t(l,f,y,h):i?.length?function(e,a,o,n){const s=[],i=[];return e.forEach((e=>{s.push(r(n,e)),i.push({key:e})})),t(s,a,i,o)}(i,f,h,n):function(e,a,r){return t(new Array(e.length).fill(-1),e,a,r)}(f,y,h));return h}(i,u,d,s)),l&&(u=await async function(e,t,o,n){const{data:s,indexes:i,keys:c,metadata:l}=e;let d=[...t],u=s||[],h=l||[];if(0===u.length&&c?.size){const e=await a(n,c)??[];u=e.map((e=>e.data)),h=e.map((e=>e.metadata))}0===h.length&&c?.size&&(h=[...c].map((e=>({key:e}))));u.length&&(i?.length?d=function(e,t,a,r){const o=[...r];return e.forEach(((e,r)=>{if(o[e]){const n={data:t[r],key:a[r]?.key,metadata:a[r]};o.splice(e,1,n)}})),o}(i,u,h,d):c?.size&&(d=function(e,t,a,o,n){const s=[...o];return e.forEach((e=>{const o=r(n,e),i={data:t[o],key:a[o]?.key,metadata:a[o]};o>=0&&s.splice(o,1,i)})),s}(c,u,h,d,o)));return d}(l,u,d,s)),u}})),define("oj-c/hooks/UNSAFE_useDataProvider/DataProviderHandler",["require","exports","./utils"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataProviderHandler=void 0;e.DataProviderHandler=class{constructor(e,a,r){this.handleMutateEvent=async e=>{const{detail:a}=e,r=this.addBusyState("updating data from mutation event"),o=await(0,t.getUpdatedItemsFromMutationDetail)(a,this.currentData,this.dataProvider);r?.(),this.currentData=o,this.callback?.onDataUpdated?.(o)},this.handleRefreshEvent=()=>{this._fetchDataAndNotify()},this.addBusyState=a,this.callback=r,this.dataProvider=e,this.currentData=[],e.addEventListener("refresh",this.handleRefreshEvent),e.addEventListener("mutate",this.handleMutateEvent),this._fetchDataAndNotify()}destroy(){this.callback=void 0,this.currentData=[],this.dataProvider.removeEventListener("refresh",this.handleRefreshEvent),this.dataProvider.removeEventListener("mutate",this.handleMutateEvent)}async _fetchData(){const e=[],t=this.dataProvider.fetchFirst({size:-1});for await(const a of t){const t=a.data.map(((e,t)=>({data:e,key:a.metadata[t].key,metadata:a.metadata[t]})));e.push(...t)}return this.currentData=e.slice(),e}async _fetchDataAndNotify(){const e=this.addBusyState("fetching data"),t=await this._fetchData();this.callback?.onDataUpdated?.(t),e()}}})),define("oj-c/hooks/UNSAFE_useDataProvider/useDataProvider",["require","exports","preact/hooks","./DataProviderHandler"],(function(require,e,t,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useDataProvider=void 0,e.useDataProvider=function({addBusyState:e,data:r}){const[o,n]=(0,t.useState)([]),s=(0,t.useRef)();return(0,t.useEffect)((()=>(void 0!==r&&(s.current=new a.DataProviderHandler(r,e,{onDataUpdated:n})),()=>{s.current?.destroy(),s.current=void 0})),[r,e]),{data:o}}})),define("oj-c/conveyor-belt/conveyor-belt",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/translationBundle","ojs/ojcontext","@oracle/oraclejet-preact/UNSAFE_ConveyorBelt","@oracle/oraclejet-preact/hooks/UNSAFE_useUser","ojs/ojvcomponent","preact/hooks","preact/compat","./conveyorBeltItem","oj-c/hooks/UNSAFE_useDataProvider/useDataProvider","css!oj-c/conveyor-belt/conveyor-belt-styles.css"],(function(require,e,t,a,r,o,n,s,i,c,l,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConveyorBelt=void 0;const u=(0,c.forwardRef)((({addBusyState:e,onScrollPositionChanged:a,items:r,itemTemplate:n,children:s,...c},u)=>{const h=(0,i.useRef)(null);(0,i.useImperativeHandle)(u,(()=>({scrollElementIntoView:e=>h.current?.scrollElementIntoView(e),scrollPrevious:()=>h.current?.scrollPrevious(),scrollNext:()=>h.current?.scrollNext()})),[]);const f=function(e){return e&&"fetchFirst"in e||!1}(r),{data:y}=(0,d.useDataProvider)({data:f?r:void 0,addBusyState:e}),v=(0,i.useMemo)((()=>{const e=!f&&r?[...r].map((e=>{const t={key:e.key};return{key:e.key,data:{data:e.data,metadata:t}}})):[];return f?Array.isArray(y)?y.map((e=>{const t={key:e.key};return{key:e.key,data:{data:e.data,metadata:e.metadata??t}}})):[]:e}),[y,f,r]),m=n?v.map(((e,a)=>{const r={index:a,data:e.data,metadata:e.data.metadata};return(0,t.jsx)(l.ConveyorBeltItem,{context:r,itemTemplate:n})})):s;return(0,t.jsx)(o.ConveyorBelt,{onScrollPositionChanged:e=>{e&&a?.(e)},ref:h,...c,children:m})}));e.ConveyorBelt=(0,s.registerCustomElement)("oj-c-conveyor-belt",(0,c.forwardRef)((({children:e,orientation:a="horizontal",...o},c)=>{const l=(0,i.useRef)(),d=(0,i.useRef)(null),h=(0,i.useRef)(r.getContext(l.current).getBusyContext()),f=(0,i.useCallback)((e=>h.current?.addBusyState({description:`oj-c-conveyor-belt: ${e}`})),[]),{direction:y}=(0,n.useUser)();return(0,i.useImperativeHandle)(c,(()=>({scrollElementIntoView:e=>d.current?.scrollElementIntoView(e)})),[]),(0,t.jsx)(s.Root,{ref:l,onKeyDown:e=>{if(e.target===l.current)if("horizontal"===a)switch(e.key){case"ArrowRight":"rtl"===y?d.current?.scrollPrevious():d.current?.scrollNext(),e.preventDefault();break;case"ArrowLeft":"rtl"===y?d.current?.scrollNext():d.current?.scrollPrevious(),e.preventDefault()}else if("vertical"===a)switch(e.key){case"ArrowDown":d.current?.scrollNext(),e.preventDefault();break;case"ArrowUp":d.current?.scrollPrevious(),e.preventDefault()}},children:(0,t.jsx)(u,{ref:d,addBusyState:f,orientation:a,...o,children:e})})})),"ConveyorBelt",{slots:{"":{},itemTemplate:{data:{}}},properties:{scrollPosition:{type:"number",writeback:!0},arrowVisibility:{type:"string",enumValues:["auto","hidden","visible"]},items:{type:"Array<object>|DataProvider"},orientation:{type:"string",enumValues:["horizontal","vertical"]}},extension:{_WRITEBACK_PROPS:["scrollPosition"],_READ_ONLY_PROPS:[]},methods:{scrollElementIntoView:{}}},{orientation:"horizontal"},{"@oracle/oraclejet-preact":a.default})})),define("oj-c/conveyor-belt",["require","exports","oj-c/conveyor-belt/conveyor-belt"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConveyorBelt=void 0,Object.defineProperty(e,"ConveyorBelt",{enumerable:!0,get:function(){return t.ConveyorBelt}})}));
//# sourceMappingURL=conveyor-belt.js.map