define(['exports', 'preact/jsx-runtime', 'preact/hooks', 'preact/compat', './refUtils-d354a169', './Layer-9fb9ca67', './LayerHost-1b4d03f0', './Modal-991f1310', './FocusTrap-d351e5c9', './tabbableUtils-428c264e', './positionUtils-6e4daa31', './clientHints-fff66be9', './useOutsideClick-39a81428', './useAnimation-5a74955f', './useUser-abae2493', './useTestId-d0c49456', './useSwipe-d22a98f1', './useComponentTheme-5aa41a8f', './colors-879e20e6', './mergeInterpolations-9ede4cf7', './UNSAFE_DrawerPopup/themes/redwood/DrawerPopupTheme'], (function(e,t,n,r,o,s,a,i,u,l,c,d,m,f,p,b,h,g,v,y,w){"use strict";const E="0px",O=250,k=r.forwardRef((({children:e,isOpen:r=!1,autoFocusRef:a,placement:k="start",modality:C="modal",onClose:R,onTransitionEnd:x,"aria-label":A,"aria-labelledby":T,"aria-describedby":F,testId:P,...D},S)=>{const[I,M]=n.useState(r?"initial":"unmounted"),[j,U]=n.useState("hidden"),[H,L]=n.useState(!r),[N,W]=n.useState("overlay"),X=n.useRef("unmounted"),Y=n.useRef(null),z=n.useRef(null),$=n.useMemo((()=>o.mergeRefs(Y,S)),[Y,S]),K="bottom"===k,B=n.useRef(!1),_={opening:()=>K?{from:{translateY:Q()},to:{translateY:E},options:{duration:O}}:{from:{translateX:J()},to:{translateX:E},options:{duration:O}},closing:()=>K?{from:{translateY:E},to:{translateY:Q()},options:{duration:O}}:{from:{translateX:E},to:{translateX:J()},options:{duration:O}}},q=b.useTestId(P),{direction:G}=p.useUser(),J=()=>{return`${"right"===c.normalizePosition(k,G)?"":"-"}${e=Y.current,Math.round(e.getBoundingClientRect().width)}px`;var e},Q=()=>{return`${e=Y.current,Math.round(e.offsetHeight)}px`;var e},V=n.useCallback((()=>{Y.current?.style?.removeProperty("transform")}),[]),{nodeRef:Z}=f.useAnimation(I,{animationStates:_,isAnimatedOnMount:!0,onAnimationEnd:()=>{"opening"===I?(V(),(()=>{const e=l.getAutofocusFocusables(Y.current);e.length>0?l.focusOn(e[0]):l.focusWithin(Y.current)})(),x?.(!0)):r||(B.current=Y.current?.contains(l.getActiveElement())||!1,Z(null),U("hidden"),M("unmounted"),x?.(!1))}});n.useEffect((()=>("unmounted"!==I||r||I===X.current?"unmounted"===I&&r?M("initial"):"initial"===I&&r?(Z(Y.current),L(!1),M("opening")):"opening"===I&&r?U("visible"):r||"unmounted"===I||(L(!0),M("closing")):B.current&&(l.focusOnElementOrNearestAncestor(z.current),B.current=!1),()=>{X.current=I})),[r,I,Z]),n.useEffect((()=>()=>{Y.current?.contains(l.getActiveElement())&&setTimeout((()=>{l.focusOnElementOrNearestAncestor(z.current)}),0)}),[]),n.useEffect((()=>{if("opening"===I&&(z.current=l.getActiveElement(),"modeless"===C&&z.current?.addEventListener("keydown",ee)),"closing"===I&&"modeless"===C)return()=>{z.current?.removeEventListener("keydown",ee)}}),[C,I]);const ee=e=>{z.current===l.getActiveElement()&&"F6"===e.code&&(e.preventDefault(),e.stopPropagation(),l.focusWithin(Y.current))},te=n.useCallback((e=>{const t=z.current;switch(e.code){case"Escape":R?.({reason:"escapeKey"});break;case"F6":if("modeless"===C){e.preventDefault(),e.stopPropagation(),t&&l.focusOn(t);break}}}),[R,C]),ne=n.useCallback((()=>{R?.({reason:"outsideClick"})}),[R]),re=[Y];z.current&&z.current!==document.body&&re.push(z),m.useOutsideClick({isDisabled:H,ref:re,handler:ne});const oe=d.getClientHints(),se=n.useCallback((()=>"ios"===oe.platform?document.documentElement.clientWidth:window.innerWidth),[oe.platform]),ae=n.useCallback((()=>{const e=se();"overlay"===N&&e<600&&W("fullOverlay"),"fullOverlay"===N&&e>600&&W("overlay")}),[se,N]);n.useEffect((()=>{if(Y.current&&"opening"===I){const e=new ResizeObserver((()=>{ae()}));return e.observe(document.body),()=>{e.unobserve(document.body)}}}),[I,ae]);const ie=n.useCallback((()=>{R?.({reason:"swipe"})}),[R]),ue=n.useCallback((e=>{const t=e.direction;"ltr"===G&&("start"===k&&"left"===t||"end"===k&&"right"===t)&&ie(),"rtl"===G&&("start"===k&&"right"===t||"end"===k&&"left"===t)&&ie(),"bottom"===k&&"down"===t&&ie()}),[G,k,ie]),{swipeProps:le}=h.useSwipe(ue,{threshold:50,maximumTime:750,tolerance:40}),{classes:ce}=g.useComponentTheme(w.DrawerPopupRedwoodTheme,{placement:K?k:"rtl"===G?"start"===k?"right":"left":"start"===k?"left":"right",visibility:j,displayModeHorizontal:["start","end"].indexOf(k)>-1?N:void 0}),de=[...Object.values(v.colorInterpolations)],me=y.mergeInterpolations(de),{...fe}=me(D),pe=()=>t.jsx(u.FocusTrap,{autoFocusRef:a,restoreFocusRef:!1,children:t.jsx("div",{ref:$,className:ce,style:fe,tabIndex:-1,role:"dialog",onKeyDown:te,"aria-label":A,"aria-labelledby":T,"aria-describedby":F,...le,...q,children:e})}),be="unmounted"!==I;return be?"modal"===C?t.jsx(i.Modal,{isOpen:be,children:pe()}):t.jsx(s.Layer,{children:pe()}):null}));e.DrawerPopup=k}));
//# sourceMappingURL=DrawerPopup-772c8c22.js.map
